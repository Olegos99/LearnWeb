<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="style.css" rel="stylesheet">
    </head>
    <body onload="FillTheTable()">
        <div id="backgroundImage">
            <h1 class="placeinmid">
                Film Editor Page
            </h1>
            <br><br>
            <button onclick="CreateNew()" class="placeinmid">Create New Movie</button>
            <br>
            <table id="MainTable">
                <tr><th>Film Name</th><th>Film Poster</th><th>Edit</th><th>Delete</th></tr>
            </table>

        </div>
        

        <script>
            console.log("You can see 'requests' in Aplication session storage");
            const filmsUrl = "https://api.tvmaze.com/shows";

            async function FillTheTable()
            {
                const films = await fetch(filmsUrl);

                if(films.ok)
                {
                    const FilmsData = await films.json();
                    for(i = 0; i < 10 ; i ++)
                    {
                        CreateFilmTR(FilmsData[i].name, FilmsData[i].image.medium, i);
                    }
                }
                else
                console.log("An Error oqured");
            }

            function CreateFilmTR(FilmName, FilmPosterSrc, FilmId)
            {
                var placeToAdd = document.getElementById("MainTable");
                var NewTR = document.createElement("tr");
                var movieName = document.createElement("h3");
                var movieImage = document.createElement("img");

                NewTR.id = FilmId;

                NewTR.innerHTML=`
                <td class="child name">${FilmName}</td>
                <td class="child"><img src="${FilmPosterSrc}"></td>
                <td class="child"><button onclick="Update(${FilmId})" class ="updateButton">Update</button></td>
                <td class="child"><button onclick="Delete(${FilmId})" class ="deleteButton">Delete</button></td>
                `;
                placeToAdd.append(NewTR);
            }

            function Update(id)
            {
                var parent = document.getElementById(id);
                var children = parent.querySelectorAll('.child');
                sessionStorage.setItem("Edit film with id", id);
                sessionStorage.setItem("Edit film with name", children[0].innerHTML);
                window.location.href = '\EditFilmScreen.HTML';
            }

            async function Delete(id)
            {
                var parent = document.getElementById(id);
                var children = parent.querySelectorAll('.child');
                if(confirm(`You want to delete permanetly "${children[0].innerHTML}" film?`))
                {
                sessionStorage.setItem("DELITE film with id", id);

                //request for deliting
                sessionStorage.setItem("Last fetch request", `Fetching with : ${filmsUrl}/${sessionStorage.getItem("DELITE film with id")} to make 'DELETE' request`);
                //WITH REAL API IT SHOULD WORK (I WAS TOLD TO COMMENT THIS)

                // const DeleteRequest = await fetch(`${filmsUrl}/${sessionStorage.getItem("DELITE film with id")}`, {
                //     method : "delete", //  (create ("post")  /  update("put")  /  delete ("delete")  / get - default?)
                // });

                // if(PostRequest.ok)
                // {
                //     console.log(PostRequest);
                // }
                // else
                // console.log("Error in updating");

                //WITH REAL API IT SHOULD WORK (I WAS TOLD TO COMMENT THIS)

                }
            }

            function CreateNew()
            {
                window.location.href = '\CreateNewMoviePage.HTML';
            }
        </script>
        
    </body>
</html>